<div class="container mt-4">
  <h2>Gestion des Utilisateurs</h2>

  <!-- Tableau des utilisateurs -->
  <table class="table table-bordered mt-3">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Nom</th>
        <th>Prénom</th>
        <th>Email</th>
        <th>Rôle</th>
        <th>Téléphone</th>
        <th>Adresse</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let utilisateur of utilisateurs"
          (click)="selectUtilisateur(utilisateur)"
          [class.table-primary]="selectedUtilisateur.id === utilisateur.id">
        <td>{{ utilisateur.id }}</td>
        <td>{{ utilisateur.nom }}</td>
        <td>{{ utilisateur.prenom }}</td>
        <td>{{ utilisateur.email }}</td>
        <td>{{ utilisateur.role }}</td>
        <td>{{ utilisateur.telephone || '-' }}</td>
        <td>{{ utilisateur.adresse || '-' }}</td>
       <td class="d-flex justify-content-center gap-2">
  <button class="btn btn-info btn-sm"
    (click)="selectUtilisateur(utilisateur); $event.stopPropagation()">
    Détails
  </button>

  <button class="btn btn-warning btn-sm"
    (click)="selectUtilisateur(utilisateur); $event.stopPropagation()">
    Modifier
  </button>

  <button class="btn btn-danger btn-sm"
    (click)="deleteUtilisateur(utilisateur.id); $event.stopPropagation()">
    Supprimer
  </button>
</td>
      </tr>
    </tbody>
  </table>

  <!-- Formulaire création / édition -->
  <div class="mt-4 p-3 border rounded">
    <h4>{{ selectedUtilisateur.id === 0 ? 'Ajouter un utilisateur' : 'Modifier l\'utilisateur' }}</h4>
    <form (ngSubmit)="saveUtilisateur()" #utilisateurForm="ngForm">
      <div class="mb-2">
        <label for="nom" class="form-label">Nom</label>
        <input type="text" id="nom" class="form-control" [(ngModel)]="selectedUtilisateur.nom" name="nom" required>
      </div>
      <div class="mb-2">
        <label for="prenom" class="form-label">Prénom</label>
        <input type="text" id="prenom" class="form-control" [(ngModel)]="selectedUtilisateur.prenom" name="prenom" required>
      </div>
      <div class="mb-2">
        <label for="email" class="form-label">Email</label>
        <input type="email" id="email" class="form-control" [(ngModel)]="selectedUtilisateur.email" name="email" required>
      </div>
      <div class="mb-2">
        <label for="role" class="form-label">Rôle</label>
        <select id="role" class="form-select" [(ngModel)]="selectedUtilisateur.role" name="role" required>
          <option value="admin">Admin</option>
          <option value="employe">Employé</option>
          <option value="client">Client</option>
        </select>
      </div>
      <div class="mb-2">
        <label for="telephone" class="form-label">Téléphone</label>
        <input type="text" id="telephone" class="form-control" [(ngModel)]="selectedUtilisateur.telephone" name="telephone">
      </div>
      <div class="mb-2">
        <label for="adresse" class="form-label">Adresse</label>
        <input type="text" id="adresse" class="form-control" [(ngModel)]="selectedUtilisateur.adresse" name="adresse">
      </div>
      <div class="mb-2">
  <label for="password" class="form-label">Mot de passe</label>
  <input type="password" id="password" class="form-control"
         [(ngModel)]="selectedUtilisateur.password" name="password"
         required minlength="6">
</div>
      <div class="mt-3">
        <button type="submit" class="btn btn-primary">{{ selectedUtilisateur.id === 0 ? 'Ajouter' : 'Enregistrer' }}</button>
        <button type="button" class="btn btn-secondary ms-2" (click)="clearSelection()">Annuler</button>
      </div>
    </form>
  </div>

  <!-- Détails utilisateur sélectionné (optionnel) -->
  <div *ngIf="selectedUtilisateur && selectedUtilisateur.id !== 0" class="mt-3 p-3 border rounded">
    <h4>Détails de l'utilisateur sélectionné</h4>
    <p><strong>Nom:</strong> {{ selectedUtilisateur.nom }}</p>
    <p><strong>Prénom:</strong> {{ selectedUtilisateur.prenom }}</p>
    <p><strong>Email:</strong> {{ selectedUtilisateur.email }}</p>
    <p><strong>Rôle:</strong> {{ selectedUtilisateur.role }}</p>
    <p><strong>Téléphone:</strong> {{ selectedUtilisateur.telephone || '-' }}</p>
    <p><strong>Adresse:</strong> {{ selectedUtilisateur.adresse || '-' }}</p>
  </div>
</div>
